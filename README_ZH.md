# Cloudflare Tunnel ä»£ç†æœåŠ¡

[![GitHub License](https://img.shields.io/badge/license-Apache%202.0-blue.svg
)](https://opensource.org/licenses/Apache-2.0)
[![Cloudflareå…¼å®¹ç‰ˆæœ¬](https://img.shields.io/badge/cloudflared-v2025.2.0-green
)](https://github.com/cloudflare/cloudflared)

[English](README.md)

é€šè¿‡Cloudflare Argo Tunnelå®ç°ä¸¤ä¸ªç§ç½‘çš„äº’è”äº’é€šï¼Œæ”¯æŒTCP/UDPåè®®è½¬å‘, æ”¯æŒTUNè®¾å¤‡ã€‚

## ğŸ› ï¸ å®‰è£…æ­¥éª¤

### 1. è·å–ç¨‹åº

```bash
git clone https://github.com/fmnx/cftun.git
cd cftun
go build
```

# Tunnel æœåŠ¡é…ç½®è¯´æ˜

æœ¬æ–‡æ¡£ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ JSON é…ç½®æ–‡ä»¶æ¥éƒ¨ç½² Tunnel éš§é“æœåŠ¡ã€‚
é…ç½®æ–‡ä»¶åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼šæœåŠ¡ç«¯é…ç½®å’Œå®¢æˆ·ç«¯é…ç½®ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚

---

## é…ç½®æ–‡ä»¶ç»“æ„

é…ç½®æ–‡ä»¶ä¸º JSON æ ¼å¼ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼š

- **server**ï¼šæœåŠ¡ç«¯ç›¸å…³é…ç½®
- **client**ï¼šå®¢æˆ·ç«¯ç›¸å…³é…ç½®

### 1. æœåŠ¡ç«¯é…ç½® (`server`)

- **token**  
  ç”¨äºæœåŠ¡ç«¯è®¤è¯çš„ä»¤ç‰Œï¼Œæ§åˆ¶å°åˆ›å»ºéš§é“åç”Ÿæˆçš„tokenã€‚  
  è‹¥æ— cloudflareå¸å·ï¼Œå¯å¡«å…¥`quick`ï¼Œ å°†ä¼šé€šè¿‡try.cloudflare.comç”³è¯·ä¸€ä¸ªä¸´æ—¶åŸŸåã€‚  
  ä¸´æ—¶åŸŸåæœåŠ¡ç«¯è¿è¡ŒæœŸé—´é•¿æœŸæœ‰æ•ˆï¼Œå½“æœåŠ¡ç«¯å…³é—­è¶…è¿‡10åˆ†é’Ÿåå°†ä¼šå¤±æ•ˆï¼Œå†æ¬¡å¯åŠ¨æ—¶åŸŸåå°†ä¼šå‘ç”Ÿæ”¹å˜ã€‚  
  æ³¨æ„ï¼šä¸´æ—¶åŸŸåéœ€è¦é…åˆå®¢æˆ·ç«¯çš„`global-url`ä½¿ç”¨ï¼Œé€šè¿‡åœ¨æ¯ä¸ªéš§é“é…ç½®ä¸­è®¾ç½®`remote`æŒ‡å®šè½¬å‘åœ°å€ã€‚

- **edge-ips** (å¯é€‰)  
  æŒ‡å®šæœåŠ¡ç«¯ä¼˜é€‰IPåˆ—è¡¨ï¼Œä¸‹åˆ—ä¸ºæ”¯æŒèŒƒå›´ï¼Œç«¯å£ä¸º`7844`ã€‚
  ```yaml
  198.41.192.0/20
  2606:4700:a0::/48
  2606:4700:a1::/48
  2606:4700:a8::/48
  2606:4700:a9::/48
  ```

- **ha-conn** (å¯é€‰)  
  é«˜å¯ç”¨ QUIC è¿æ¥æ•°ï¼Œæ ¹æ®ç½‘ç»œç¯å¢ƒè¿›è¡Œé€‚å½“é…ç½®ã€‚

- **bind-address** (å¯é€‰)  
  æŒ‡å®šæœåŠ¡ç«¯å‡ºå£ç½‘å¡çš„ IP åœ°å€ã€‚å¦‚æ— ç‰¹æ®Šéœ€æ±‚å»ºè®®ç•™ç©º

- **warp** (å¯é€‰)  
  æœåŠ¡ç«¯å‡ºå£æ·»åŠ warpåŒæ ˆæ”¯æŒï¼ŒåŸºäºwireguardã€‚

    - **auto** (å¯é€‰)  
      æ˜¯å¦è‡ªåŠ¨ç”³è¯·warp.é»˜è®¤å€¼ä¸º`false` [true|false]

    - **endpoint** (å¯é€‰)  
      wireguard ç»ˆç«¯ã€‚å½“`auto`ä¸º`false`æ—¶ï¼Œæ­¤é¡¹å¿…å¡«ã€‚

    - **ipv4** (å¯é€‰)  
      wireguard ipv4åœ°å€ã€‚å½“`auto`ä¸º`false`æ—¶ï¼Œæ­¤é¡¹å¿…å¡«ã€‚

    - **ipv6** (å¯é€‰)  
      wireguard ipv6åœ°å€ã€‚

    - **reserved** (å¯é€‰)  
      è®¾ç½®warpçš„wireguardä¿ç•™å­—æ®µã€‚

    - **private-key** (å¯é€‰)  
      wireguard ç§é’¥ã€‚å½“`auto`ä¸º`false`æ—¶ï¼Œæ­¤é¡¹å¿…å¡«ã€‚

    - **public-key** (å¯é€‰)  
      wireguard å…¬é’¥ã€‚å½“`auto`ä¸º`false`æ—¶ï¼Œæ­¤é¡¹å¿…å¡«ã€‚

    - **proxy4** (å¯é€‰)  
      å‡ºå£æ˜¯å¦ä½¿ç”¨warpä»£ç†ipv4æµé‡. [true|false]

    - **proxy6** (å¯é€‰)  
      å‡ºå£æ˜¯å¦ä½¿ç”¨warpä»£ç†ipv6æµé‡. [true|false]

### 2. å®¢æˆ·ç«¯é…ç½® (`client`)

- **cdn-ip** (å¯é€‰)  
  ä¼˜é€‰ Cloudflare Anycast IPï¼Œå¦‚æœä¸è®¾ç½®åˆ™è§£æurlä¸­çš„åŸŸåã€‚

- **cdn-port** (å¯é€‰)  
  CDN çš„ç«¯å£è®¾ç½®ã€‚wsæ ‡å‡†ç«¯å£ä¸º `80`ï¼Œwssæ ‡å‡†ç«¯å£ä¸º `443`ï¼Œé»˜è®¤ä¸º443ç«¯å£ã€‚

- **scheme** (å¯é€‰)  
  åè®®æ–¹æ¡ˆï¼Œæ”¯æŒ `ws` æˆ– `wss`ï¼Œé»˜è®¤ä¸ºwssï¼Œä½¿ç”¨éæ ‡å‡†ç«¯å£æ—¶éœ€æ ¹æ®å®é™…æƒ…å†µè®¾ç½®ã€‚

- **global-url** (å¯é€‰)  
  Tunnelæ§åˆ¶å°é…ç½®è·¯å¾„ï¼Œå¦‚æœå­˜åœ¨ pathï¼Œè¯·ä¸€å¹¶å¡«å†™ã€‚

- **tun** (å¯é€‰)  
  Tunè®¾å¤‡é…ç½®ã€‚

    - **enable** (å¯é€‰)  
      æ˜¯å¦å¯ç”¨tunè®¾å¤‡ï¼Œé»˜è®¤ä¸ºå¦ã€‚[true|false]

    - **name** (å¯é€‰)  
      tunè®¾å¤‡åï¼Œé»˜è®¤ä¸º`cftun0`ã€‚

    - **ipv4** (å¯é€‰)  
      è‡ªå®šä¹‰tunè®¾å¤‡ipv4åœ°å€ã€‚

    - **ipv6** (å¯é€‰)  
      è‡ªå®šä¹‰tunè®¾å¤‡ipv6åœ°å€ã€‚

    - **mtu** (å¯é€‰)  
      è‡ªå®šä¹‰tunè®¾å¤‡MTUå¤§å°ã€‚

    - **interface** (å¯é€‰)  
      tunè®¾å¤‡æŒ‡å®šå‡ºå£ç½‘å¡ï¼Œé»˜è®¤ä¸ºç³»ç»Ÿä¸»ç½‘å¡ã€‚

    - **log-level** (å¯é€‰)  
      tunè®¾å¤‡æ—¥å¿—çº§åˆ«ï¼Œ[debug|info|warn|error|silent], é»˜è®¤ä¸º`info`ã€‚

    - **routes** (å¯é€‰)  
      tunè®¾å¤‡è·¯ç”±é…ç½®è§„åˆ™ã€‚

- **tunnels** (å¯é€‰)  
  éš§é“é…ç½®åˆ—è¡¨ï¼Œæ¯ä¸ªéš§é“åŒ…å«ä»¥ä¸‹é…ç½®ï¼š

    - **listen** (å¿…é€‰)  
      æœ¬åœ°ç›‘å¬åœ°å€åŠç«¯å£, å»ºè®®ä½¿ç”¨127.0.0.1ã€‚

    - **remote** (å¯é€‰)  
      è½¬å‘åˆ°æŒ‡å®šçš„ç›®æ ‡åœ°å€(ç•™ç©ºåˆ™ä½¿ç”¨æ§åˆ¶å°é…ç½®çš„ç›®æ ‡åœ°å€)

    - **url** (å¯é€‰)  
      ä¼˜å…ˆä½¿ç”¨è¯¥é¡¹é…ç½®(ç•™ç©ºåˆ™ä½¿ç”¨`global-url`)ã€‚

    - **protocol** (å¯é€‰)  
      æŒ‡å®šéš§é“ä½¿ç”¨çš„åè®®ï¼Œæ”¯æŒ `tcp` æˆ– `udp`ï¼Œé»˜è®¤ä¸º`tcp`ã€‚

    - **timeout** (å¯é€‰)  
      UDP è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ï¼Œé»˜è®¤ä¸º 60 ç§’ï¼Œå¦‚éœ€è°ƒæ•´å¯å•ç‹¬é…ç½®ã€‚

---

## ç¤ºä¾‹é…ç½®æ–‡ä»¶

### ä»¥ä¸‹æ˜¯serverç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š

```json
{
  "server": {
    "token": "quick",
    "edge-ips": [
      "198.41.192.77:7844",
      "198.41.197.78:7844",
      "198.41.202.79:7844",
      "198.41.207.80:7844"
    ],
    "ha-conn": 4,
    "bind-address": ""
  }
}
```

### ä»¥ä¸‹æ˜¯clientä½¿ç”¨tunæ¨¡å¼é…ç½®æ–‡ä»¶ï¼š

```json
{
  "client": {
    "cdn-ip": "104.17.143.163",
    "cdn-port": 80,
    "scheme": "ws",
    "global-url": "argo.s01.dev",
    "tun": {
      "enable": true,
      "name": "tun1",
      "interface": "eth0",
      "log-level": "error",
      "routes": [
        "0.0.0.0/0",
        "::/1"
      ]
    }
  }
}
```

### ä»¥ä¸‹æ˜¯clientä½¿ç”¨`global-url`çš„ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š

```json
{
  "client": {
    "cdn-ip": "104.17.143.163",
    "cdn-port": 80,
    "scheme": "ws",
    "global-url": "argo.s01.dev",
    "tunnels": [
      {
        "listen": "127.0.0.1:2408",
        "remote": "162.159.192.1:2408",
        "protocol": "udp",
        "timeout": 30
      },
      {
        "listen": "127.0.0.1:2222",
        "remote": "127.0.0.1:22",
        "protocol": "tcp"
      },
      {
        "listen": "127.0.0.1:5201",
        "remote": "127.0.0.1:5201",
        "protocol": "udp",
        "timeout": 30
      },
      {
        "listen": "127.0.0.1:5201",
        "remote": "127.0.0.1:5201",
        "protocol": "tcp"
      }
    ]
  }
}
```

### ä»¥ä¸‹æ˜¯clientä½¿ç”¨ç‹¬ç«‹`url`çš„ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š

```json
{
  "client": {
    "cdn-ip": "104.17.143.163",
    "cdn-port": 80,
    "scheme": "ws",
    "global-url": "",
    "tunnels": [
      {
        "listen": "127.0.0.1:2408",
        "url": "warp.example.com",
        "protocol": "udp",
        "timeout": 30
      },
      {
        "listen": "127.0.0.1:2222",
        "url": "ssh.example.com",
        "protocol": "tcp"
      },
      {
        "listen": "127.0.0.1:5201",
        "url": "iperf3.example.com/udp",
        "protocol": "udp",
        "timeout": 30
      },
      {
        "listen": "127.0.0.1:5201",
        "url": "iperf3.example.com/tcp",
        "protocol": "tcp"
      }
    ]
  }
}
```
