# Cloudflare Tunnel ä»£ç†æœåŠ¡

[![GitHub License](https://img.shields.io/badge/license-Apache%202.0-blue.svg
)](https://opensource.org/licenses/Apache-2.0)
[![Cloudflareå…¼å®¹ç‰ˆæœ¬](https://img.shields.io/badge/cloudflared-v2025.2.0-green
)](https://github.com/cloudflare/cloudflared)

é€šè¿‡Cloudflare Tunnelå®ç°å†…ç½‘æœåŠ¡çš„å®‰å…¨æš´éœ²ï¼Œæ”¯æŒTCP/UDPæ··åˆåè®®è½¬å‘ã€‚åŸºäº[ä¿®æ”¹ç‰ˆcloudflared](https://github.com/fmnx/cloudflared)å®šåˆ¶å¼€å‘çš„å®¢æˆ·ç«¯ã€‚

## ğŸ“¦ å‰ç½®è¦æ±‚
- å¦‚æœéœ€è¦è‡ªè¡Œç¼–è¯‘ï¼Œå¿…é¡»ä½¿ç”¨[Cloudflare Golangç¯å¢ƒ](https://github.com/cloudflare/go)
- æ­¤å¤„é»˜è®¤æ‚¨å·²çŸ¥æ‚‰å¦‚ä½•åœ¨cloudflare webæ§åˆ¶å°é…ç½®tunnel
- ç”±äºæ§åˆ¶å°ç›®å‰ä¸æ”¯æŒè®¾ç½®UDPï¼Œæ§åˆ¶å°è¯·é€‰æ‹©RDPä»£æ›¿

## ğŸ› ï¸ å®‰è£…æ­¥éª¤

### 1. è·å–ç¨‹åº
```bash
git clone https://github.com/fmnx/cftun.git
cd cftun
go build
```

# Tunnel æœåŠ¡é…ç½®è¯´æ˜

æœ¬æ–‡æ¡£ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ JSON é…ç½®æ–‡ä»¶æ¥éƒ¨ç½² Tunnel éš§é“æœåŠ¡ã€‚
é…ç½®æ–‡ä»¶åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼šæœåŠ¡ç«¯é…ç½®å’Œå®¢æˆ·ç«¯é…ç½®ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚

---

## é…ç½®æ–‡ä»¶ç»“æ„

é…ç½®æ–‡ä»¶ä¸º JSON æ ¼å¼ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼š

- **server**ï¼šæœåŠ¡ç«¯ç›¸å…³é…ç½®
- **client**ï¼šå®¢æˆ·ç«¯ç›¸å…³é…ç½®

### 1. æœåŠ¡ç«¯é…ç½® (`server`)

- **token**  
  ç”¨äºæœåŠ¡ç«¯è®¤è¯çš„ä»¤ç‰Œï¼Œæ§åˆ¶å°åˆ›å»ºéš§é“åç”Ÿæˆçš„tokenã€‚  
  è‹¥æ— cloudflareå¸å·ï¼Œå¯å¡«å…¥`quick`ï¼Œ å°†ä¼šé€šè¿‡try.cloudflare.comç”³è¯·ä¸€ä¸ªä¸´æ—¶åŸŸåã€‚  
  ä¸´æ—¶åŸŸåæœåŠ¡ç«¯è¿è¡ŒæœŸé—´é•¿æœŸæœ‰æ•ˆï¼Œå½“æœåŠ¡ç«¯å…³é—­è¶…è¿‡10åˆ†é’Ÿåå°†ä¼šå¤±æ•ˆï¼Œå†æ¬¡å¯åŠ¨æ—¶åŸŸåå°†ä¼šå‘ç”Ÿæ”¹å˜ã€‚  
  æ³¨æ„ï¼šä¸´æ—¶åŸŸåéœ€è¦é…åˆå®¢æˆ·ç«¯çš„`global-url`ä½¿ç”¨ï¼Œé€šè¿‡åœ¨æ¯ä¸ªéš§é“é…ç½®ä¸­è®¾ç½®`remote`æŒ‡å®šè½¬å‘åœ°å€ã€‚

- **edge-ips** (å¯é€‰)  
  æŒ‡å®šæœåŠ¡ç«¯ä¼˜é€‰IPåˆ—è¡¨ï¼Œæ”¯æŒèŒƒå›´ä¸º`198.41.192.0/20`ï¼Œç«¯å£ä¸º`7844`ã€‚

- **ha-conn** (å¯é€‰)  
  é«˜å¯ç”¨ QUIC è¿æ¥æ•°ï¼Œæ ¹æ®ç½‘ç»œç¯å¢ƒè¿›è¡Œé€‚å½“é…ç½®ã€‚

- **bind-address** (å¯é€‰)  
  æŒ‡å®šæœåŠ¡ç«¯å‡ºå£ç½‘å¡çš„ IP åœ°å€ã€‚å¦‚æ— ç‰¹æ®Šéœ€æ±‚å»ºè®®ç•™ç©º


### 2. å®¢æˆ·ç«¯é…ç½® (`client`)

- **cdn-ip** (å¯é€‰)  
  ä¼˜é€‰ Cloudflare Anycast IPï¼Œå¦‚æœä¸è®¾ç½®åˆ™è§£æurlä¸­çš„åŸŸåã€‚

- **cdn-port** (å¯é€‰)  
  CDN çš„ç«¯å£è®¾ç½®ã€‚å¯¹äº WebSocketï¼Œwsæ ‡å‡†ç«¯å£ä¸º `80`ï¼Œwssæ ‡å‡†ç«¯å£ä¸º `443`ã€‚

- **scheme** (å¯é€‰)  
  åè®®æ–¹æ¡ˆï¼Œæ”¯æŒ `ws` æˆ– `wss`ï¼Œä½¿ç”¨éæ ‡å‡†ç«¯å£æ—¶éœ€æ ¹æ®å®é™…æƒ…å†µè®¾ç½®ã€‚

- **global-url** (å¯é€‰)  
  Tunnelæ§åˆ¶å°é…ç½®è·¯å¾„ï¼Œå¦‚æœå­˜åœ¨ pathï¼Œè¯·ä¸€å¹¶å¡«å†™ã€‚

- **tunnels** (å¯é€‰)  
  éš§é“é…ç½®åˆ—è¡¨ï¼Œæ¯ä¸ªéš§é“åŒ…å«ä»¥ä¸‹é…ç½®ï¼š

    - **listen** (å¿…é€‰)  
      æœ¬åœ°ç›‘å¬åœ°å€åŠç«¯å£, å»ºè®®ä½¿ç”¨127.0.0.1ã€‚

    - **remote** (å¯é€‰)  
      è½¬å‘åˆ°æŒ‡å®šçš„ç›®æ ‡åœ°å€(ç•™ç©ºåˆ™ä½¿ç”¨æ§åˆ¶å°é…ç½®çš„ç›®æ ‡åœ°å€)

    - **url** (å¯é€‰)  
      ä¼˜å…ˆä½¿ç”¨è¯¥é¡¹é…ç½®(ç•™ç©ºåˆ™ä½¿ç”¨`global-url`)ã€‚

    - **protocol** (å¿…é€‰)  
      æŒ‡å®šæœ¬åœ°ç›‘å¬ç«¯å£ä½¿ç”¨çš„åè®®ï¼Œæ”¯æŒ `tcp` æˆ– `udp`ã€‚

    - **timeout** (å¯é€‰)  
      UDP è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ï¼Œé»˜è®¤ä¸º 60 ç§’ï¼Œå¦‚éœ€è°ƒæ•´å¯å•ç‹¬é…ç½®ã€‚

---

## ç¤ºä¾‹é…ç½®æ–‡ä»¶

ä»¥ä¸‹æ˜¯serverç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ç›´æ¥å¤åˆ¶å¹¶æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œä¿®æ”¹ï¼š
```json
{
  "server": {
    "token": "quick",
    "edge-ips": [
      "198.41.192.77:7844",
      "198.41.197.78:7844",
      "198.41.202.79:7844",
      "198.41.207.80:7844"
    ],
    "ha-conn": 4,
    "bind-address": ""
  }
}
```

ä»¥ä¸‹æ˜¯clientä½¿ç”¨`global-url`çš„ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ç›´æ¥å¤åˆ¶å¹¶æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œä¿®æ”¹ï¼š
```json
{
  "client": {
    "cdn-ip": "104.17.143.163",
    "cdn-port": 80,
    "scheme": "ws",
    "global-url": "tunnel.qzzz.io",
    "tunnels": [
      {
        "listen": "127.0.0.1:2408",
        "remote": "162.159.192.1:2408",
        "protocol": "udp",
        "timeout": 30
      },
      {
        "listen": "127.0.0.1:2222",
        "remote": "127.0.0.1:22",
        "protocol": "tcp"
      },
      {
        "listen": "127.0.0.1:5201",
        "remote": "127.0.0.1:5201",
        "protocol": "udp",
        "timeout": 30
      },
      {
        "listen": "127.0.0.1:5201",
        "remote": "127.0.0.1:5201",
        "protocol": "tcp"
      }
    ]
  }
}
```

ä»¥ä¸‹æ˜¯clientä½¿ç”¨ç‹¬ç«‹`url`çš„ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ç›´æ¥å¤åˆ¶å¹¶æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œä¿®æ”¹ï¼š
```json
{
  "client": {
    "cdn-ip": "104.17.143.163",
    "cdn-port": 80,
    "scheme": "ws",
    "global-url": "",
    "tunnels": [
      {
        "listen": "127.0.0.1:2408",
        "url": "warp.qzzz.io",
        "protocol": "udp",
        "timeout": 30
      },
      {
        "listen": "127.0.0.1:2222",
        "url": "ssh.qzzz.io",
        "protocol": "tcp"
      },
      {
        "listen": "127.0.0.1:5201",
        "url": "iperf3.qzzz.io/udp",
        "protocol": "udp",
        "timeout": 30
      },
      {
        "listen": "127.0.0.1:5201",
        "url": "iperf3.qzzz.io/tcp",
        "protocol": "tcp"
      }
    ]
  }
}
```
